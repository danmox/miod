<launch>

  <!-- simulation args -->
  <arg name="gazebo_gui"  default="false" />
  <arg name="rviz"        default="true" />
  <arg name="network_viz" default="true"/>

  <!-- patrol demo args -->
  <arg name="nta"   value="2"/> <!-- number of task (patrol) agents -->
  <arg name="nna"   value="4"/> <!-- number of network agents -->
  <arg name="rad"   value="55.0"/> <!-- radius of patrol circle -->
  <param name="/task_agent_count"    value="$(arg nta)"/>
  <param name="/network_agent_count" value="$(arg nna)"/>
  <param name="/patrol_radius"       value="$(arg rad)"/>

  <!-- gazebo and rviz -->
  <include file="$(find intel_aero_gazebo)/launch/simulation.launch">
    <arg name="gazebo_gui"       value="$(arg gazebo_gui)"/>
    <arg name="world"            value="$(find intel_aero_gazebo)/worlds/spawc.world"/>
    <arg name="rviz"             value="$(arg rviz)"/>
    <arg name="rviz_config_file" value="$(find intel_aero_demos)/rviz/patrol.rviz"/>
  </include>

  <!-- network topology visualization -->
  <include if="$(arg network_viz)"
           file="$(find intel_aero_gazebo)/launch/network_viz.launch">
    <arg name="static_map_topic" value="/projected_map"/>
    <arg name="world_frame"      value="world"/>
  </include>

  <!-- load saved octomap -->
  <node pkg="octomap_server"
        type="octomap_server_node"
        name="static_map_node"
        args="$(find intel_aero_gazebo)/maps/spawc_no_ground.bt"
        output="screen">
    <remap from="projected_map" to="/projected_map"/>
    <param name="frame_id" value="world"/>
  </node>

  <!-- task (patrol) agents -->

  <arg name="task_vel"    value="1.0"/>
  <arg name="network_vel" value="2.0"/>

  <group>
    <arg name="id" value="1"/>
    <include file="$(find intel_aero_gazebo)/launch/intel_aero_spawn_only.launch">
      <arg name="id"             value="$(arg id)"/>
      <arg name="x"              value="20.0"/>
      <arg name="y"              value="0.0"/>
      <arg name="linear_vel_des" value="$(arg task_vel)"/>
      <!--
      <arg name="x"         value="$(eval arg('rad')*cos((arg('id')-1)*2.0*3.1415/arg('nta')))"/>
      <arg name="y"         value="$(eval arg('rad')*sin((arg('id')-1)*2.0*3.1415/arg('nta')))"/>
      -->
    </include>
  </group>

  <group>
    <arg name="id" value="2"/>
    <include file="$(find intel_aero_gazebo)/launch/intel_aero_spawn_only.launch">
      <arg name="id"             value="$(arg id)"/>
      <arg name="x"              value="-20.0"/>
      <arg name="y"              value="0.0"/>
      <arg name="linear_vel_des" value="$(arg task_vel)"/>
      <!--
      <arg name="x"         value="$(eval arg('rad')*cos((arg('id')-1)*2.0*3.1415/arg('nta')))"/>
      <arg name="y"         value="$(eval arg('rad')*sin((arg('id')-1)*2.0*3.1415/arg('nta')))"/>
      -->
    </include>
  </group>

  <!-- network agents -->

  <group>
    <arg name="id" value="3"/>
    <include file="$(find intel_aero_gazebo)/launch/intel_aero_spawn_only.launch">
      <arg name="id"             value="$(arg id)"/>
      <arg name="x"              value="10.0"/>
      <arg name="y"              value="0.0"/>
      <arg name="linear_vel_des" value="$(arg network_vel)"/>
    </include>
  </group>

  <group>
    <arg name="id" value="4"/>
    <include file="$(find intel_aero_gazebo)/launch/intel_aero_spawn_only.launch">
      <arg name="id"             value="$(arg id)"/>
      <arg name="x"              value="-1.0"/>
      <arg name="y"              value="5.0"/>
      <arg name="linear_vel_des" value="$(arg network_vel)"/>
    </include>
  </group>

  <group>
    <arg name="id" value="5"/>
    <include file="$(find intel_aero_gazebo)/launch/intel_aero_spawn_only.launch">
      <arg name="id"             value="$(arg id)"/>
      <arg name="x"              value="-10.0"/>
      <arg name="y"              value="0.0"/>
      <arg name="linear_vel_des" value="$(arg network_vel)"/>
    </include>
  </group>

  <group>
    <arg name="id" value="6"/>
    <include file="$(find intel_aero_gazebo)/launch/intel_aero_spawn_only.launch">
      <arg name="id"             value="$(arg id)"/>
      <arg name="x"              value="1.0"/>
      <arg name="y"              value="-5.0"/>
      <arg name="linear_vel_des" value="$(arg network_vel)"/>
    </include>
  </group>

</launch>
